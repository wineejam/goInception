(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{439:function(_,t,v){"use strict";v.r(t);var e=v(44),s=Object(e.a)({},(function(){var _=this,t=_.$createElement,v=_._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"osc"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#osc"}},[_._v("#")]),_._v(" osc")]),_._v(" "),v("h3",{attrs:{id:"pt-online-schema-change"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#pt-online-schema-change"}},[_._v("#")]),_._v(" pt-online-schema-change")]),_._v(" "),v("ul",[v("li",[_._v("使用前需要手动下载安装"),v("code",[_._v("percona-toolkit")]),_._v(" ("),v("code",[_._v("v3.0.4")]),_._v("或参数兼容版本)")]),_._v(" "),v("li",[_._v("使用前需要指定pt-osc目录参数"),v("code",[_._v("osc_bin_dir")]),_._v("，默认为"),v("code",[_._v("/usr/local/bin")])])]),_._v(" "),v("p",[_._v("####参数设置")]),_._v(" "),v("p",[_._v("pt-osc工具的设置参数可以可以通过"),v("code",[_._v("inception show variables like 'osc%';")]),_._v("查看")]),_._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[_._v("inception "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("show")]),_._v(" variables "),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("like")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[_._v("'osc%'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])]),v("p",[_._v("支持以下方式设置:")]),_._v(" "),v("ul",[v("li",[_._v("1.通过"),v("code",[_._v("inception set")]),_._v("设置")])]),_._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[_._v("inception "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("set")]),_._v(" osc_check_interval "),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[_._v("10")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])]),v("ul",[v("li",[_._v("2.配置config.toml,并通过"),v("code",[_._v("-config=config.toml")]),_._v("指定配置文件启动")])]),_._v(" "),v("h4",{attrs:{id:"进程命令"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#进程命令"}},[_._v("#")]),_._v(" 进程命令")]),_._v(" "),v("p",[_._v("#####查看osc进程")]),_._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[_._v("inception get osc processlist"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])]),v("p",[_._v("返回结果：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("DBNAME")]),_._v(" "),v("th",[_._v("TABLENAME")]),_._v(" "),v("th",[_._v("COMMAND")]),_._v(" "),v("th",[_._v("SQLSHA1")]),_._v(" "),v("th",[_._v("PERCENT")]),_._v(" "),v("th",[_._v("REMAINTIME")]),_._v(" "),v("th",[_._v("INFOMATION")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("test_inc")]),_._v(" "),v("td",[_._v("t1")]),_._v(" "),v("td",[_._v("alter table t1 add column c33 int")]),_._v(" "),v("td",[_._v("*E53542EFF4E179BE267210114EC5EDBEF9DC5D8F")]),_._v(" "),v("td",[_._v("9")]),_._v(" "),v("td",[_._v("00:36")]),_._v(" "),v("td",[_._v("Copying "),v("code",[_._v("test_inc")]),_._v("."),v("code",[_._v("t1")]),_._v(":   9% 00:36 remain")])])])]),_._v(" "),v("p",[_._v("#####查看指定osc进程")]),_._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[_._v("inception get osc_percent "),v("span",{pre:!0,attrs:{class:"token string"}},[_._v("'*E53542EFF4E179BE267210114EC5EDBEF9DC5D8F'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])]),v("p",[_._v("返回结果：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("DBNAME")]),_._v(" "),v("th",[_._v("TABLENAME")]),_._v(" "),v("th",[_._v("SQLSHA1")]),_._v(" "),v("th",[_._v("PERCENT")]),_._v(" "),v("th",[_._v("REMAINTIME")]),_._v(" "),v("th",[_._v("INFOMATION")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("test_inc")]),_._v(" "),v("td",[_._v("t1")]),_._v(" "),v("td",[_._v("*E53542EFF4E179BE267210114EC5EDBEF9DC5D8F")]),_._v(" "),v("td",[_._v("49")]),_._v(" "),v("td",[_._v("00:14")]),_._v(" "),v("td",[_._v("Copying "),v("code",[_._v("test_inc")]),_._v("."),v("code",[_._v("t1")]),_._v(":  49% 00:14 remain")])])])]),_._v(" "),v("p",[_._v("#####终止指定osc进程\n"),v("code",[_._v("终止后注意手动清理相关辅助表")])]),_._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[_._v("inception "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("kill")]),_._v(" osc "),v("span",{pre:!0,attrs:{class:"token string"}},[_._v("'*E53542EFF4E179BE267210114EC5EDBEF9DC5D8F'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[_._v("-- 或同义词")]),_._v("\ninception stop "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("alter")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[_._v("'*E53542EFF4E179BE267210114EC5EDBEF9DC5D8F'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])]),v("h3",{attrs:{id:"参数说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[_._v("#")]),_._v(" 参数说明")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("参数")]),_._v(" "),v("th",[_._v("默认值")]),_._v(" "),v("th",[_._v("可选范围")]),_._v(" "),v("th",[_._v("说明")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("osc_on")]),_._v(" "),v("td",[_._v("false")]),_._v(" "),v("td",[_._v("bool")]),_._v(" "),v("td",[_._v("OSC开关")])]),_._v(" "),v("tr",[v("td",[_._v("osc_alter_foreign_keys_method")]),_._v(" "),v("td",[_._v("none")]),_._v(" "),v("td",[_._v("string")]),_._v(" "),v("td",[_._v("对应OSC参数alter-foreign-keys-method")])]),_._v(" "),v("tr",[v("td",[_._v("osc_bin_dir")]),_._v(" "),v("td",[_._v("/usr/local/bin")]),_._v(" "),v("td",[_._v("string")]),_._v(" "),v("td",[_._v("pt-online-schema-change脚本的位置")])]),_._v(" "),v("tr",[v("td",[_._v("osc_check_alter")]),_._v(" "),v("td",[_._v("true")]),_._v(" "),v("td",[_._v("bool")]),_._v(" "),v("td",[_._v("对应参数--[no]check-alter")])]),_._v(" "),v("tr",[v("td",[_._v("osc_check_interval")]),_._v(" "),v("td",[_._v("5")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--check-interval，意义是Sleep time between checks for --max-lag.")])]),_._v(" "),v("tr",[v("td",[_._v("osc_check_replication_filters")]),_._v(" "),v("td",[_._v("true")]),_._v(" "),v("td",[_._v("bool")]),_._v(" "),v("td",[_._v("对应参数--[no]check-replication-filters")])]),_._v(" "),v("tr",[v("td",[_._v("osc_chunk_size")]),_._v(" "),v("td",[_._v("1000")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--chunk-size")])]),_._v(" "),v("tr",[v("td",[_._v("osc_chunk_size_limit")]),_._v(" "),v("td",[_._v("4")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--chunk-size-limit")])]),_._v(" "),v("tr",[v("td",[_._v("osc_chunk_time")]),_._v(" "),v("td",[_._v("1")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--chunk-time")])]),_._v(" "),v("tr",[v("td",[_._v("osc_check_unique_key_change "),v("code",[_._v("v1.0.5")])]),_._v(" "),v("td",[_._v("true")]),_._v(" "),v("td",[_._v("bool")]),_._v(" "),v("td",[_._v("对应参数--[no]check_unique_key_change,设置是否检查唯一索引")])]),_._v(" "),v("tr",[v("td",[_._v("osc_critical_thread_connected")]),_._v(" "),v("td",[_._v("1000")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--critical-load中的thread_connected部分")])]),_._v(" "),v("tr",[v("td",[_._v("osc_critical_thread_running")]),_._v(" "),v("td",[_._v("80")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--critical-load中的thread_running部分")])]),_._v(" "),v("tr",[v("td",[_._v("osc_drop_new_table")]),_._v(" "),v("td",[_._v("true")]),_._v(" "),v("td",[_._v("bool")]),_._v(" "),v("td",[_._v("对应参数--[no]drop-new-table")])]),_._v(" "),v("tr",[v("td",[_._v("osc_drop_old_table")]),_._v(" "),v("td",[_._v("true")]),_._v(" "),v("td",[_._v("bool")]),_._v(" "),v("td",[_._v("对应参数--[no]drop-old-table")])]),_._v(" "),v("tr",[v("td",[_._v("osc_max_flow_ctl "),v("code",[_._v("v1.2.2")])]),_._v(" "),v("td",[_._v("-1")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--max-flow-ctl. 检查集群暂停流量控制所花费的平均时间 (仅适用于PXC 5.6及以上版本,版本自动判断). -1表示不开启. 非PXC集群会自动忽略该参数")])]),_._v(" "),v("tr",[v("td",[_._v("osc_max_lag")]),_._v(" "),v("td",[_._v("3")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--max-lag")])]),_._v(" "),v("tr",[v("td",[_._v("osc_max_thread_connected")]),_._v(" "),v("td",[_._v("1000")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--max-load中的thread_connected部分")])]),_._v(" "),v("tr",[v("td",[_._v("osc_max_thread_running")]),_._v(" "),v("td",[_._v("80")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v("对应参数--max-load中的thread_running部分")])]),_._v(" "),v("tr",[v("td",[_._v("osc_min_table_size")]),_._v(" "),v("td",[_._v("16")]),_._v(" "),v("td",[_._v("int")]),_._v(" "),v("td",[_._v('OSC的开关，如果设置为0，则全部ALTER语句都走OSC，如果设置为非0，则当这个表占用空间大小大于这个值时才使用OSC方式。单位为M，这个表大小的计算方式是通过语句： select (DATA_LENGTH + INDEX_LENGTH)/1024/1024 from information_schema.tables where table_schema = "dbname" and table_name = "tablename"来实现的。')])]),_._v(" "),v("tr",[v("td",[_._v("osc_print_none")]),_._v(" "),v("td",[_._v("false")]),_._v(" "),v("td",[_._v("bool")]),_._v(" "),v("td",[_._v("用来设置在Inception返回结果集中，对于原来OSC在执行过程的标准输出信息是不是要打印到结果集对应的错误信息列中，如果设置为1，就不打印，如果设置为0，就打印。而如果出现错误了，则都会打印")])]),_._v(" "),v("tr",[v("td",[_._v("osc_print_sql")]),_._v(" "),v("td",[_._v("false")]),_._v(" "),v("td",[_._v("bool")]),_._v(" "),v("td",[_._v("对应参数--print")])]),_._v(" "),v("tr",[v("td",[_._v("osc_sleep "),v("code",[_._v("v1.2.4")])]),_._v(" "),v("td",[_._v("0.0")]),_._v(" "),v("td",[_._v("float")]),_._v(" "),v("td",[_._v("对应参数--sleep")])]),_._v(" "),v("tr",[v("td",[_._v("osc_recursion_method")]),_._v(" "),v("td",[_._v("processlist")]),_._v(" "),v("td",[_._v("string")]),_._v(" "),v("td",[_._v("对应参数recursion_method")])])])])])}),[],!1,null,null,null);t.default=s.exports}}]);